<!DOCTYPE html>
<html>
	<head>
		<title>Checkbox Saving</title>
		<style>
			.hide-unchecked div:not(.checked)
			{
				display: none;
			}

			div {
				//border: 1px solid black;
			}

			:not(.hide-unchecked) div.checked > div
			{
				margin-left: 2em;
				display: block !important;
			}
		</style>
		<script>
			window.onload = init;

			function updateToggleButton()
			{
				document.querySelector('body').classList.add('initClass');
				document.querySelector('body').classList.remove('initClass');
				document.getElementById('toggle-show-checked').innerHTML =
						document.querySelector('body').classList.contains('hide-unchecked') ? "Show all" : "Hide unchecked";
			}

			function updateHash()
			{
				checkboxes = document.querySelectorAll('input[type=checkbox]');
				hash = "#Data:";
				for (var i = 0; i < checkboxes.length; i++) {
					if (checkboxes[i].checked)
					{
						hash += checkboxes[i].getAttribute('id') + ",";
					}
				};
				hash = hash.replace(/,$/, '');
				window.location.hash = hash;
				readHash();
			}

			function addIds()
			{
				checkboxes = document.querySelectorAll('input[type=checkbox]');
				for (var i = 0; i < checkboxes.length; i++) {
					checkboxes[i].outerHTML += checkboxes[i].getAttribute('id').replace(/^#/, '') + "&nbsp;";
				};
			}

			function readHash()
			{
				checkedData = window.location.hash.split(",");
				if (checkedData != undefined && checkedData.length > 0)
				{
					checkedData[0] = checkedData[0].replace("#Data:", "");
				}

				checkboxes = document.querySelectorAll('input[type=checked]');
				for (var i = 0; i < checkboxes.length; i++) {
					checkboxes[i].removeAttribute('checked');
					checkboxes[i].parentNode.classList.remove('checked');
				};

				for (var i = 0; i < checkedData.length; i++) {
					if (document.getElementById(checkedData[i]) == undefined)
					{
						console.error("Checked data contains invalid id: '" + checkedData[i] + "' which is the " + (i+1) + " element of page parameters.");
						continue;
					}
					document.getElementById(checkedData[i]).setAttribute('checked', true);
					console.log(document.getElementById(checkedData[i]));
					element = document.getElementById(checkedData[i]);
					element.parentNode.classList.add('checked');
				};
			}

			function init()
			{
				document.getElementById('toggle-show-checked').addEventListener('click', function (target) {
					document.querySelector('body').classList.toggle('hide-unchecked');
					updateToggleButton();
				}, false);

				document.querySelector('body').addEventListener('click', updateHash, false);

				if (window.location.hash)
				{
					document.querySelector('body').classList.add('hide-unchecked');
					readHash();
				}
				else
				{
					document.querySelector('body').classList.remove('hide-unchecked');
				}
				updateToggleButton();
				updateHash();
				addIds();
			}
		</script>
	</head>
	<body>
		<button id='toggle-show-checked'>UnsetButtonText</button><br>
		<div>
			<input type='checkbox' id='0' />
			RandomText
			<p>Testingpara</p>
		</div>
		<div>
			<div>
				RandomText<p>Testingpara</p>
			</div>
			<input type='checkbox' id='1' />
		</div>
	</body>
</html>
